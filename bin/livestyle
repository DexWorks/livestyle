#!/usr/bin/env node

/*jslint nomen:false */
/*global require, __dirname */
var express = require('express'),
    util = require('util'),
    fs = require('fs'),
    path = require('path'),
    app = express.createServer(),
    commandLineOptions = require('optimist')
        .usage('Usage: $0 [-p <portNumber>] [-h <hostName>] publicDir')
        .default('host', '0.0.0.0')
        .alias('host', 'h')
        .default('port', 3000)
        .alias('port', 'p')
        .argv,
    publicDir = path.normalize(commandLineOptions._[0] || process.cwd());

app.configure(function () {
    app
        .use(express.logger())
        .use(require('../lib/middleware/injectLiveStyleScriptIncludeIntoHtml')())
        .use(express['static'](publicDir))
        .use(express.errorHandler({dumpExceptions: true, showStack: true}));

    require('../lib/installLiveCssFileWatcherInServer')(app, publicDir, require('socket.io'));
});

app.listen(commandLineOptions.port, commandLineOptions.host);

console.log('Serving static files from ' + publicDir);
console.log('Listening to http://' + commandLineOptions.host + ':' + commandLineOptions.port + '/');
